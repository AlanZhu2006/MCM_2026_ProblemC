# 阶段2：粉丝投票估计模型 - 使用指南

## 概述

阶段2的目标是从已知的淘汰结果反推粉丝投票数（逆问题求解）。由于粉丝投票数据是保密的，我们需要通过数学模型来估计。

## 核心任务

1. ✅ **建立数学模型估计粉丝投票**
   - 考虑因素：评委评分、历史表现、选手特征、专业舞者等
   
2. ✅ **验证模型**
   - 检查估计值是否与已知淘汰结果一致
   
3. ✅ **不确定性量化**
   - 使用置信区间、蒙特卡洛方法等

## 快速开始

### 方法1：使用Python脚本（推荐）

```bash
python scripts/run_stage2_fan_vote_estimation.py
```

这将自动执行所有阶段2的任务。

### 方法2：在Python代码中使用

```python
import pandas as pd
from fan_vote_estimator import FanVoteEstimator

# 加载处理后的数据
df = pd.read_csv('2026_MCM_Problem_C_Data_processed.csv')

# 创建估计器
estimator = FanVoteEstimator(df)

# 估计所有周次的粉丝投票
estimates_df = estimator.estimate_all_weeks()

# 验证模型
validation_results = estimator.validate_estimates(estimates_df)

# 不确定性量化
uncertainty_df = estimator.quantify_uncertainty_monte_carlo(estimates_df, n_simulations=500)
```

## 模型方法

### 1. 排名法（Rank-based Method）

**适用季次**：第1-2季，第28-34季

**原理**：
- 综合排名 = 评委排名 + 粉丝排名
- 被淘汰选手的综合排名应该最高（最差）

**优化目标**：
- 最小化粉丝投票与评委评分的差异
- 满足约束：被淘汰选手的综合排名最高

### 2. 百分比法（Percent-based Method）

**适用季次**：第3-27季

**原理**：
- 综合百分比 = 评委百分比 + 粉丝百分比
- 被淘汰选手的综合百分比应该最低

**优化目标**：
- 最小化粉丝投票与评委评分的差异
- 满足约束：被淘汰选手的综合百分比最低

### 3. 特征工程

模型考虑以下特征：

1. **评委评分特征**
   - 每周的评委总分
   - 评委排名
   - 评委百分比

2. **历史表现特征**
   - 前几周的平均评分
   - 前几周的平均排名
   - 历史趋势

3. **选手特征**
   - 年龄
   - 行业（职业类别）
   - 地区

4. **专业舞者特征**
   - 专业舞者的历史平均表现
   - 专业舞者的受欢迎程度

## 输出文件

运行脚本后会生成：

1. **`fan_vote_estimates.csv`**
   - 包含所有周次的粉丝投票估计值
   - 列包括：season, week, celebrity_name, fan_votes, judge_total, voting_method, eliminated

2. **`fan_vote_uncertainty.csv`**
   - 包含不确定性分析结果
   - 列包括：置信区间、标准差、中位数等

3. **`validation_results.json`**
   - 模型验证结果
   - 包括准确率、正确/错误预测数量等

4. **`stage2_fan_vote_report.txt`**
   - 文本格式的摘要报告

## 模型验证

模型验证通过以下方式进行：

1. **淘汰预测准确率**
   - 使用估计的粉丝投票计算综合得分
   - 检查预测的被淘汰选手是否与实际一致
   - 计算准确率

2. **一致性检查**
   - 检查估计值是否满足投票组合方法的约束条件
   - 验证综合得分排序是否正确

## 不确定性量化

使用蒙特卡洛方法量化不确定性：

1. **方法**：
   - 对每个估计值添加随机噪声（10%标准差）
   - 进行多次模拟（默认500次）
   - 计算统计量

2. **输出**：
   - 均值（mean）
   - 标准差（std）
   - 95%置信区间（CI lower, CI upper）
   - 中位数（median）

## 注意事项

1. **逆问题求解**
   - 这是一个逆问题，可能存在多个解
   - 模型使用优化算法寻找最合理的解
   - 如果优化失败，会使用启发式方法

2. **数据质量**
   - 确保阶段1预处理已完成
   - 某些周次可能无法确定被淘汰选手，模型会使用启发式方法

3. **计算时间**
   - 处理所有34季可能需要较长时间
   - 可以先用前几季测试：`estimator.estimate_all_weeks(seasons=[1, 2, 3])`

4. **不确定性解释**
   - 不确定性反映了估计值的可靠性
   - 不同选手/周次的不确定性可能不同
   - 建议关注置信区间的宽度

## 模型改进建议

如果需要提高模型性能，可以考虑：

1. **更复杂的特征**
   - 选手的社交媒体影响力
   - 专业舞者的知名度
   - 季节因素（后期可能有更多关注）

2. **更高级的优化方法**
   - 使用遗传算法
   - 使用贝叶斯方法
   - 考虑多目标优化

3. **集成方法**
   - 结合多个模型的预测
   - 使用投票或加权平均

## 下一步

完成阶段2后，可以：
- 查看估计结果和验证报告
- 分析不确定性模式
- 进入阶段3：投票方法比较分析

## 常见问题

**Q: 模型准确率低怎么办？**
A: 可以尝试调整优化参数，或使用更复杂的特征工程。

**Q: 某些周次无法确定被淘汰选手？**
A: 模型会使用启发式方法（假设评委评分最低的选手被淘汰）。

**Q: 不确定性很大怎么办？**
A: 这是正常的，因为这是逆问题。可以关注置信区间，或使用更多模拟次数。

**Q: 可以只处理特定季次吗？**
A: 可以，使用 `estimator.estimate_all_weeks(seasons=[1, 2, 3])` 指定季次。
